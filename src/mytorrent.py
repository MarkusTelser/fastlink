from concurrent.futures import ThreadPoolExecutor
from Torrent import TorrentData
from TorrentParser import TorrentParser
from trackers.HTTPTracker import HTTPTracker
from trackers.UDPTracker import UDPTracker
from peer_protocol.peer import Peer
import socket

# load data from torrent
fp = "../data/all/testtest.torrent"
parser = TorrentParser(filepath=fp)
data = parser.parse()

def get_peer_list():
    # create all threads and communicate to tracker
    print("-"*30)
    futures = []
    with ThreadPoolExecutor(max_workers=50) as executor:
        for i, announce in enumerate(data.announces):
            print(announce)
            ann = data.getAnnounceConnection(announce)
            if ann == "http" or ann == "https":
                tr = HTTPTracker(announce)
                future = executor.submit(tr.main, data)
                futures.append(future)
            elif ann == "udp":
                address = TorrentData.getLinkFromAnnounce(announce)
                port = TorrentData.getPortFromAnnounce(announce)
                tr = UDPTracker(address, port)
                future = executor.submit(tr.main, data)
                futures.append(future)
            else:
                print("Unknown tracker type:", ann)
        executor.shutdown(wait=True)
    print("-" * 30)


    # get peers back
    print("-" * 30)
    working = 0
    peer_list = set()
    for i, future in enumerate(futures):
        f = future.exception()
        print(i)
        if f == None:
            if type(future.result()) == list:
                working += 1
                for res in future.result():
                    peer_list.add(res)
        else:
            print("exception tracker:", f)
    print(working,"out of", len(futures),"tracker working")
    print("-" * 30)

    print(peer_list)
    print(len(peer_list))


peer_list = {('212.252.137.109', 34594), ('14.36.129.97', 48216), ('103.240.96.231', 48243), ('41.174.116.237', 6881), ('27.34.13.215', 41372), ('150.107.107.9', 24595), ('41.216.202.132', 52721), ('203.190.15.222', 46656), ('202.53.59.48', 39498), ('37.190.205.62', 60015), ('178.239.165.243', 52859), ('172.98.80.27', 22725), ('175.100.20.198', 24464), ('93.61.147.122', 14414), ('180.190.18.109', 12008), ('95.183.51.103', 64327), ('218.76.29.219', 22079), ('202.72.227.113', 6881), ('58.173.1.221', 20028), ('157.119.186.46', 6881), ('104.3.29.31', 28794), ('37.120.133.166', 1049), ('202.161.82.79', 54835), ('164.74.160.68', 50007), ('197.211.58.77', 6881), ('81.171.17.44', 50183), ('178.220.186.24', 25102), ('182.18.206.49', 35207), ('179.43.104.29', 30937), ('152.57.216.118', 38698), ('41.169.3.114', 35095), ('24.53.235.22', 25086), ('109.161.200.189', 47339), ('110.224.188.250', 6881), ('176.229.135.164', 41131), ('101.182.0.179', 35951), ('192.159.178.203', 47831), ('163.172.7.233', 51413), ('218.76.29.187', 22079), ('196.189.57.20', 27872), ('103.6.184.6', 27490), ('146.196.34.82', 43062), ('86.85.186.187', 39718), ('172.221.60.127', 60217), ('103.212.146.101', 51602), ('78.110.184.67', 63465), ('103.160.177.1', 47128), ('93.41.1.56', 20907), ('5.187.231.212', 60835), ('73.52.1.82', 51944), ('49.151.168.71', 28384), ('191.96.67.40', 16487), ('103.116.250.247', 25264), ('41.164.171.34', 22759), ('86.98.87.62', 60761), ('124.106.183.193', 27244), ('103.150.254.73', 32807), ('105.112.47.186', 12900), ('49.37.51.194', 57967), ('51.36.171.15', 34094), ('103.120.4.90', 46425), ('128.140.198.23', 56383), ('193.19.109.27', 50771), ('103.121.154.139', 20805), ('130.105.248.242', 35207), ('176.240.245.146', 39413), ('31.50.193.90', 57508), ('217.164.201.150', 42378), ('41.90.66.235', 21573), ('73.6.33.179', 6881), ('106.196.65.122', 40342), ('41.216.202.148', 57019), ('79.153.1.164', 60407), ('194.233.98.21', 47895), ('103.167.233.33', 65100), ('112.201.97.215', 16505), ('49.36.222.100', 17495), ('41.210.6.217', 6881), ('41.93.71.4', 0), ('120.28.216.49', 26389), ('159.180.249.12', 35114), ('114.130.68.101', 28817), ('24.68.20.76', 29276), ('103.93.103.34', 6881), ('49.146.145.235', 14763), ('41.84.152.6', 17742), ('41.246.130.27', 39213), ('105.112.134.178', 17846), ('202.83.126.238', 60910), ('89.187.182.111', 18279), ('172.193.9.223', 6881), ('95.184.109.62', 58082), ('103.195.201.30', 6881), ('155.0.204.50', 44451), ('5.43.242.197', 64851), ('51.83.67.62', 51882), ('197.255.130.190', 22011), ('116.68.83.111', 57632), ('46.246.122.164', 57929), ('67.230.56.248', 61867), ('49.148.118.183', 40562), ('103.211.54.67', 38688), ('103.38.130.201', 15989), ('197.185.97.189', 33569), ('180.149.234.179', 53745), ('185.17.164.99', 6881), ('102.70.49.126', 21035), ('152.57.234.64', 56263), ('180.92.137.60', 61861), ('82.77.240.57', 37879), ('119.92.59.235', 27315), ('102.65.63.39', 59380), ('196.216.10.236', 6881), ('187.190.136.94', 43985), ('41.220.241.130', 53377), ('196.188.125.230', 6881), ('90.215.137.91', 20237), ('210.18.177.209', 6881), ('49.144.3.242', 10086), ('112.79.107.246', 41947), ('103.126.12.162', 54693), ('45.251.231.117', 60918), ('196.191.53.253', 54945), ('102.176.65.9', 43729), ('1.186.114.242', 54463), ('198.91.183.141', 16881), ('105.154.223.74', 55296), ('103.58.152.32', 52412), ('202.168.85.133', 6881), ('95.34.96.24', 61137), ('103.82.145.65', 42325), ('103.204.247.22', 60504), ('66.115.165.186', 33781), ('41.222.75.82', 51162), ('197.185.110.47', 6881), ('41.190.23.238', 18195), ('84.229.1.139', 50562), ('188.156.238.108', 34828), ('103.146.17.178', 50380), ('41.89.165.9', 36354), ('45.70.185.158', 32673), ('62.6.175.58', 56328), ('180.190.153.127', 13068), ('93.146.68.238', 15457), ('110.54.234.198', 17295), ('102.65.62.72', 59069), ('103.107.196.132',15526), ('43.224.128.33', 22313), ('112.202.89.244', 4034), ('43.243.81.79', 34227), ('76.26.79.80', 55345), ('94.65.117.117', 58306), ('196.188.245.108', 27940), ('109.165.136.238', 26186), ('168.167.26.147', 58277), ('103.233.225.245', 18455), ('197.237.30.84', 26255), ('197.249.14.227', 53336), ('41.84.152.6', 38795), ('196.188.245.5', 35895), ('103.173.152.2', 64203), ('124.13.5.21', 6882), ('103.238.107.189', 6881), ('216.10.216.246', 12621), ('165.0.84.103', 26628), ('43.239.112.189', 23191), ('1.1.186.141', 26875), ('171.61.224.128', 35642), ('41.210.159.32', 61212), ('112.196.181.56', 26178), ('5.79.98.220', 48080), ('136.158.78.135', 6881), ('49.37.33.22', 64057), ('180.190.217.212', 31064), ('190.213.47.185', 43790), ('45.64.163.139', 6881), ('185.130.139.27', 32816), ('223.102.31.193', 14188), ('202.163.76.208', 56717), ('41.220.29.106', 11436), ('90.148.131.224', 36110), ('49.149.73.103', 6881), ('89.211.143.226', 43883), ('39.45.47.183', 37979), ('119.2.107.243', 31206), ('82.79.243.143', 33091), ('120.245.132.80', 22996), ('102.221.21.82', 53471), ('102.67.178.228', 23937), ('111.119.183.16', 49261), ('106.51.241.23', 6881), ('168.167.95.164', 55704), ('213.143.71.184', 21060), ('103.132.225.144', 49917), ('183.78.93.116', 59976), ('213.55.83.51', 35040), ('42.0.35.199', 12417), ('94.66.56.132', 12264), ('39.38.25.124', 62677), ('69.73.211.221', 20920), ('109.201.152.179', 1), ('217.138.219.173',51413), ('103.86.182.210', 50604), ('46.99.27.43', 23900), ('115.189.89.79', 48319), ('175.176.23.20', 49040), ('112.201.167.194', 29140), ('197.185.96.0', 60910), ('41.75.191.250', 0), ('103.113.149.126', 39083), ('158.140.130.130', 48953), ('49.145.46.12', 6881), ('5.192.144.189', 42430), ('103.120.71.131', 52978), ('103.27.2.16', 37484), ('154.117.148.166', 47578), ('205.164.133.139', 50639), ('91.150.178.247', 51592), ('136.158.78.222', 16363), ('27.34.108.105', 27485), ('116.206.159.239', 56001), ('46.99.88.235', 23900), ('45.250.213.4', 15120), ('27.106.0.240', 51566), ('203.122.20.98', 24950), ('116.204.252.220', 10312), ('37.210.234.104', 19451), ('78.182.192.36', 45714), ('41.164.153.122', 26668), ('86.107.21.62', 55468), ('89.64.50.128', 26058), ('58.97.218.49', 6881), ('114.74.42.175', 43056), ('84.70.210.4', 6881), ('45.133.192.70', 28213), ('27.96.210.243', 21142), ('179.61.240.98', 38151), ('154.70.213.115', 46703), ('37.58.59.70', 60711), ('101.53.233.225', 37445), ('103.146.217.164', 40878), ('154.117.148.162', 24235), ('207.228.78.6', 53483), ('119.155.42.20', 10148), ('112.211.47.156', 14363), ('103.115.202.85', 35766), ('188.27.80.7', 28665), ('201.82.58.202', 30802), ('43.241.193.155', 27854), ('139.5.18.1', 50320), ('72.143.205.236', 35619), ('103.217.111.22', 39178), ('112.201.133.254', 40300), ('160.178.116.46', 48212), ('116.197.154.82', 10315), ('61.149.215.222', 63143), ('109.88.98.144', 0), ('103.141.70.161', 40090), ('70.139.17.204', 40369), ('112.208.109.81', 49506), ('154.65.112.110', 61984), ('154.70.45.230', 26275), ('103.127.95.166', 51908), ('89.35.30.232', 51413), ('121.214.240.252', 43520), ('200.43.134.101',60124), ('116.206.244.114', 6881), ('182.74.159.107', 49997), ('103.4.147.250', 49214), ('47.31.223.162', 19749), ('102.164.0.136', 47475), ('102.141.149.25', 16143), ('49.36.213.1', 12191), ('103.141.64.19', 6881), ('103.122.14.137', 59113), ('31.166.134.92', 6881), ('84.65.103.203', 6881), ('39.45.9.88', 22208), ('17.80.128.142', 9212), ('47.187.227.142', 14455), ('193.56.8.228', 49442), ('174.119.112.64', 13130), ('154.118.179.6', 21613), ('41.60.164.159', 39838), ('103.77.27.202', 6881), ('115.124.45.171', 61600), ('67.213.210.230', 27233), ('45.249.165.123', 20586), ('111.119.183.16', 63336), ('103.78.134.235', 25673), ('202.134.165.246', 46179), ('198.8.92.132', 46472), ('49.145.173.15', 54773), ('103.88.140.98', 52739), ('168.194.234.253', 42638), ('12.190.238.59', 64411), ('6.37.85.148', 6881), ('180.188.247.144', 39564), ('41.105.209.246', 43723), ('49.206.14.86', 61298), ('176.88.47.163', 45187), ('138.118.220.192', 6881), ('38.1.4.3', 49664), ('103.148.13.5', 6881), ('120.28.228.175', 27127), ('84.213.79.171', 6881), ('49.187.234.226', 50703), ('49.205.213.250', 47959), ('94.177.118.7', 56532), ('41.157.137.9', 6882), ('175.176.79.63', 60023), ('183.209.139.212', 14082), ('217.122.84.2', 31541), ('103.237.36.236', 41797), ('105.225.82.73', 33235), ('124.104.181.107', 33748), ('59.103.108.210', 0), ('84.217.124.211', 39032), ('186.132.105.120', 7900), ('182.185.220.156', 33244), ('78.83.198.124', 4736), ('109.177.190.128', 20412), ('27.147.204.167', 12488), ('197.181.142.235', 37111), ('84.17.48.133', 61137), ('203.211.75.35', 31328), ('76.68.64.63', 47378), ('122.174.191.113', 37000), ('146.70.57.2', 49548), ('41.164.198.165', 22136), ('27.131.13.6', 60586), ('66.115.142.156', 61638), ('103.121.221.67', 59176), ('61.9.110.251', 42289), ('86.88.29.212', 60023), ('41.78.64.254', 54197), ('49.36.227.177', 52848), ('203.162.235.43', 16722), ('197.185.107.165', 60910), ('72.239.3.34', 21758), ('94.69.16.18', 36086), ('41.216.204.28', 12161), ('143.244.34.196', 51413), ('123.253.67.187', 64941), ('49.150.47.243', 45981), ('185.246.210.196', 45682), ('101.0.41.116', 36331), ('223.25.59.99', 54972), ('103.166.244.224', 18301), ('108.60.237.159', 6881), ('41.246.130.66', 39213), ('78.57.219.103', 6881), ('112.202.244.50', 21633), ('49.36.33.146', 40465), ('41.59.4.214', 0), ('152.57.209.100', 37401), ('157.37.153.5', 6881), ('138.199.2.51', 11656), ('119.152.49.59', 6881), ('103.126.22.173', 30336), ('103.50.83.228', 59214), ('139.47.24.215', 56660), ('148.71.158.252', 54959), ('203.221.247.108', 2219), ('94.207.100.108', 6881), ('180.178.170.90', 46845), ('112.200.41.82', 62252), ('117.214.2.211', 49160), ('115.189.94.157', 17925), ('94.5.176.244', 55431), ('103.130.110.197', 45682), ('45.64.163.65', 6881), ('124.170.8.173', 14757), ('63.245.59.10', 6881), ('39.59.39.62', 18923), ('119.94.65.192', 42907), ('103.18.170.53', 37006), ('186.74.23.254', 11494), ('103.85.232.173', 38979), ('24.155.45.131', 55414), ('182.185.126.226', 44489), ('105.112.135.66', 63316), ('105.12.1.81', 63927), ('41.220.31.58', 58854), ('76.29.104.81', 64987), ('136.158.49.203', 39603), ('122.55.240.146', 42163), ('84.30.209.214', 50641), ('112.79.107.246', 42253), ('103.206.9.3', 20758), ('182.71.200.10', 42829), ('32.214.115.227', 57951), ('125.62.198.246', 39333), ('103.120.44.97', 43453), ('39.50.18.238', 61294), ('103.90.0.99', 60202), ('41.227.111.141', 11358), ('196.189.62.237', 0), ('183.193.171.153', 9300), ('219.74.122.117', 30568), ('186.29.115.139', 13164), ('45.130.83.161', 49653), ('146.70.75.29', 51413), ('102.65.63.154', 54154), ('189.6.250.30', 6881), ('103.254.128.26', 6881), ('49.37.183.113', 6881), ('103.206.60.6', 32617), ('119.160.59.248', 31450), ('103.106.187.1', 45768), ('103.66.18.110', 42203), ('103.18.74.20', 52752), ('122.2.105.5', 64261), ('175.157.30.173', 21572), ('72.27.128.52', 58474), ('103.149.159.35', 15590), ('27.147.207.211', 25686), ('80.117.33.124', 51413), ('199.101.192.14', 49165), ('49.36.191.102', 46062), ('103.113.14.161', 19723), ('112.79.107.168', 39073), ('139.5.254.71', 15122), ('60.52.68.39', 38983), ('49.145.204.35', 17268), ('136.158.31.133', 24876), ('109.121.205.194', 12178), ('0.0.64.224', 44956), ('102.182.218.209', 49160), ('103.137.94.220', 12701), ('112.201.254.190', 38927), ('41.89.226.3', 49160), ('144.48.117.197', 42555), ('67.173.19.28', 21060), ('49.148.139.102', 46299), ('206.217.139.206', 34006), ('111.119.42.18', 21804), ('212.18.57.18', 62375), ('196.191.152.4', 61466), ('182.70.162.190', 20777), ('121.45.145.250', 44229), ('49.145.4.173', 45682), ('185.92.25.70', 1062), ('154.21.212.131', 60160), ('196.207.136.61', 6881), ('117.94.78.16', 62641), ('72.252.161.55', 38192), ('71.127.1.29', 25148), ('27.34.31.74', 36962), ('202.78.235.225', 19129), ('150.129.237.138', 6881), ('54.221.44.106', 54003), ('176.58.193.167', 45682), ('156.155.155.153', 44684), ('102.140.128.133', 25032), ('82.41.115.156', 31306), ('185.232.131.30', 14756), ('49.146.24.59', 10996), ('103.102.43.6', 53165), ('103.75.162.6', 10733), ('105.246.106.148', 6881), ('152.37.184.152', 58531), ('1.144.109.251', 41247), ('113.100.44.20', 22223), ('194.223.49.61', 17148), ('84.75.65.43', 51413), ('212.102.58.181', 51413), ('91.74.213.73', 34519), ('105.162.5.120', 46871), ('218.215.97.182', 14810), ('157.40.105.197', 37000), ('91.140.147.114', 11716), ('177.17.186.69', 37253), ('184.170.250.14', 44099), ('64.119.192.119', 47651), ('103.102.122.7', 54362), ('45.116.191.228', 34065), ('41.79.199.52', 35027), ('191.96.106.249', 33781), ('0.0.0.0', 65535), ('101.128.117.193', 23170), ('49.204.143.172', 45252), ('146.199.80.66', 51413), ('120.29.68.213', 31338), ('183.83.42.54', 37871), ('183.87.96.170', 45124), ('196.188.243.246', 22223), ('202.8.115.137', 58504), ('136.158.39.240', 31149), ('45.64.160.192', 41787), ('80.240.201.83', 46374), ('134.19.185.66', 37538), ('120.29.77.197', 28193), ('156.196.229.130', 23878), ('103.50.151.132', 37866), ('112.79.107.82', 37529), ('105.232.69.0', 27502), ('103.112.55.200', 53593), ('41.212.67.86', 56205), ('103.123.169.87', 47953), ('111.119.183.16', 64591), ('41.59.4.214', 49160), ('58.69.125.83', 12814), ('24.49.195.190', 59021), ('157.44.219.41', 37000), ('41.86.59.65', 21492), ('103.157.36.178', 50716), ('61.245.146.254', 44738), ('77.167.61.246', 15297), ('89.45.90.63', 52600), ('43.231.241.29', 62427), ('103.157.240.252', 28937), ('159.118.201.35', 49160), ('179.61.240.11', 56676), ('129.232.17.255', 6881), ('103.158.62.18', 57116), ('204.160.0.0', 0), ('205.254.167.161', 12223), ('36.6.218.20', 269), ('103.80.57.106', 39935), ('43.230.65.70', 17108), ('45.251.229.174', 49310), ('103.43.65.242', 57851), ('103.100.21.30', 19179), ('84.192.2.46', 45908), ('72.27.98.48', 20962), ('112.208.97.79', 11281), ('183.87.41.131', 38121), ('82.32.187.114', 62348), ('85.85.154.159', 29618), ('176.12.10.215', 57560), ('31.166.134.92', 49156), ('117.221.206.56',38074), ('69.58.115.9', 46662), ('122.54.159.172', 42859), ('101.53.232.222', 11563), ('103.155.72.197', 38504), ('132.154.102.190', 60711), ('0.0.0.0', 0), ('188.24.135.185', 29903), ('82.58.54.127', 27598), ('185.168.241.42', 6881), ('1.38.180.187', 39695), ('212.174.70.222', 6881), ('143.244.48.137', 33781), ('27.61.181.86', 39796), ('157.40.230.3', 40599), ('117.215.238.70', 51253), ('202.66.165.26', 64966), ('84.199.187.169', 37815), ('103.35.168.206', 57558), ('107.127.54.225', 33951), ('103.92.42.68', 58456), ('49.37.35.149', 59372), ('27.187.108.232', 30077), ('90.248.151.223', 41234), ('131.100.39.45', 50058), ('102.67.176.78', 14074), ('222.217.144.237', 36403), ('72.143.205.118', 35619), ('102.39.32.126', 10706), ('86.99.16.68', 6881), ('180.75.192.189', 13665), ('197.189.178.140', 62484), ('46.26.236.35', 50913), ('103.118.77.188', 20249), ('58.168.244.36', 64297), ('202.53.175.214', 27821), ('81.37.198.179', 51413), ('205.164.154.44', 39834), ('45.249.69.112', 64818), ('103.111.122.251', 58163), ('2.49.169.12', 6881), ('115.187.42.53', 45680), ('122.163.11.14', 54129), ('154.160.30.59', 59339), ('85.246.85.13', 55772), ('103.248.94.212', 64471), ('49.149.107.87',10160), ('159.2.220.255', 23174), ('208.169.93.8', 61194), ('154.113.69.74', 26664), ('103.135.228.51', 25772), ('71.206.95.15', 52138), ('202.142.73.94', 49200), ('183.83.210.10', 21252), ('51.174.170.222', 15638), ('185.92.26.221', 14745), ('197.185.104.52', 39938), ('197.185.118.95', 52968), ('122.172.181.49', 50337), ('154.72.212.26', 10815), ('113.21.77.247', 45764), ('102.132.182.9', 58640), ('103.225.134.210', 31485), ('102.219.122.35', 10476), ('197.210.186.6', 32920), ('202.168.84.215', 38633), ('122.163.38.100', 6881), ('103.127.23.165', 61350), ('202.62.58.3', 50975), ('186.223.173.206', 58847), ('93.112.178.234', 34423), ('113.173.122.143', 8214), ('223.223.131.227', 47326), ('197.219.34.246', 11418), ('216.110.118.183', 45682), ('111.119.188.10', 10837), ('79.153.107.29', 51413), ('182.70.63.51', 33866), ('159.180.29.67', 44169), ('72.139.196.222', 24389), ('103.226.226.206', 10136), ('90.164.50.254', 55177), ('109.64.197.173', 49160), ('112.206.68.27', 60429), ('102.165.164.167', 16183), ('49.146.17.212', 49236), ('122.178.177.30', 6881), ('45.64.163.71', 51413), ('122.161.35.232', 37666), ('41.222.181.183', 0), ('81.99.101.23', 43080), ('103.141.93.88', 53493),('94.190.183.140', 38327), ('49.145.132.42', 56051), ('117.211.216.213', 6881), ('191.101.61.94', 33781), ('121.200.7.144', 24955), ('185.21.37.59', 58995), ('5.193.229.122', 34606), ('41.182.17.181', 31277), ('81.0.133.224', 20885), ('45.248.77.94', 46227), ('111.119.189.2', 54179), ('197.185.106.148', 36669), ('103.121.153.80', 16480), ('182.253.98.198', 14082), ('66.115.145.16', 52743), ('72.27.48.184', 16590), ('169.159.167.33', 49910), ('86.89.105.22', 1104), ('43.246.158.208', 26292), ('114.72.152.241', 39877), ('92.96.81.143', 50369), ('103.22.143.32', 6881), ('216.10.217.226', 43625), ('86.2.110.3', 45682), ('39.50.113.134', 29359), ('212.253.69.245', 59696), ('124.123.164.90', 16452), ('51.39.187.66', 35966), ('37.19.212.241', 48831), ('103.85.232.166', 38979), ('132.154.233.70', 60711), ('124.107.252.83', 36727), ('197.185.108.53', 37270), ('89.64.69.230', 57160), ('103.106.238.145', 55093), ('45.248.77.94', 48743), ('180.190.165.200', 11461), ('197.188.43.138', 6881), ('107.4.17.191', 49997), ('105.163.203.168', 15937), ('41.81.8.160', 14344), ('124.109.38.251', 10899), ('91.139.122.47', 10114), ('189.6.33.158', 51329), ('173.245.209.147', 17159), ('202.142.110.63', 40157), ('103.160.16.66', 62995), ('103.204.169.224', 6881), ('190.173.137.42', 47334), ('39.40.127.126', 41922), ('41.189.166.218', 62398), ('106.220.229.229', 38636), ('160.119.210.42', 37300), ('169.1.210.159', 27886), ('5.193.108.44', 6881), ('112.201.132.83', 47132), ('138.199.19.165', 63381), ('73.51.197.211', 17148), ('122.177.74.231', 6881), ('189.217.2.176', 6881), ('216.10.217.5', 62784), ('213.118.6.100', 60577), ('111.125.106.176', 6881), ('197.156.73.162', 6881), ('8.25.96.127', 38685), ('124.104.80.19', 16990), ('101.175.100.125', 26085), ('217.29.138.11', 32844), ('157.119.178.90', 39618), ('123.201.65.4', 12177), ('128.90.63.28', 44169), ('78.11.149.3', 44632), ('160.120.62.236', 41045), ('108.62.49.129', 51413), ('103.220.17.53', 64835), ('106.200.77.254', 45429), ('182.183.154.4', 10593), ('196.189.57.9', 24398), ('122.170.207.141', 63266), ('41.115.106.224', 23726), ('101.182.133.95', 29690), ('46.166.191.18', 23993), ('103.139.234.1', 6881), ('120.29.79.2', 37005), ('103.79.21.186', 23026), ('102.221.40.129', 60111), ('14.192.223.112', 11471), ('72.252.182.36', 63907), ('49.37.45.104', 64084), ('27.34.22.228', 52437), ('64.119.192.208', 38603), ('196.189.57.241', 40414), ('41.157.63.130', 55845), ('185.149.107.253', 49689), ('216.10.209.198', 23182), ('43.230.46.14', 64694), ('102.222.84.83', 0), ('113.199.253.174', 36414), ('112.135.84.164', 34622), ('27.147.190.182', 12843), ('2.50.67.222', 54992), ('103.112.55.200', 39671), ('41.216.202.106', 10185), ('102.68.120.81', 52697), ('103.150.254.76', 41730), ('27.255.58.196', 55600), ('118.100.72.32', 35547), ('89.34.231.148', 63328), ('103.58.116.78', 12182), ('154.72.168.137', 46297), ('197.255.205.198', 0), ('95.234.106.194', 13725), ('112.134.174.209', 15172), ('194.152.25.234', 51060), ('80.26.199.185', 21365), ('105.29.91.178', 42494), ('69.80.13.1', 57274), ('210.5.92.242', 48025), ('202.165.34.156', 0),('126.140.153.172', 14082), ('151.44.92.255', 0), ('218.76.29.79', 22079), ('8.28.82.19', 42747), ('109.166.138.189', 61351), ('103.102.247.0', 36462), ('197.155.69.118', 47740), ('45.123.218.23', 21931), ('178.238.11.15', 54344), ('103.121.116.217', 6883), ('103.119.95.215', 6881), ('92.27.181.108', 31102), ('182.191.89.209', 20448), ('92.114.82.244', 57163), ('86.125.53.119', 36515), ('103.239.254.139', 43996), ('182.182.249.0', 6881), ('86.99.16.68', 44763), ('102.219.123.250', 17127), ('122.167.98.179', 38719), ('111.119.183.16', 55521), ('24.71.140.128', 17074), ('119.94.128.134', 24603), ('188.140.181.10', 6881), ('197.210.84.97', 51525), ('102.39.241.154', 6881), ('117.210.165.53', 30422), ('46.196.90.20', 43611), ('176.88.45.187', 18762), ('105.242.224.178', 54205), ('103.155.20.134', 47940), ('109.255.180.100', 29411), ('197.185.109.81', 31843), ('63.140.82.185', 44880), ('37.164.53.255', 19196), ('175.176.87.4', 14990), ('103.167.232.137', 43258), ('222.26.0.214', 14568), ('103.248.35.168', 6881), ('45.64.163.157', 6881), ('103.1.212.109', 6881), ('14.99.195.66', 15470), ('37.228.200.57', 45020), ('5.29.20.197', 19280), ('117.201.160.16', 36394), ('188.64.207.24', 36696), ('91.100.184.74', 62834), ('103.135.228.113', 50021), ('82.173.144.47', 42403), ('102.164.0.133', 48758), ('108.20.39.185', 51413), ('103.140.63.50', 56303), ('122.180.217.93', 6881), ('202.142.107.51', 60002), ('181.170.252.154', 51413), ('142.117.108.112', 27140), ('103.165.50.18', 39748), ('93.173.252.64', 6881), ('102.119.191.126', 57508), ('41.66.224.241', 28275), ('194.110.84.36', 1247), ('188.214.152.229', 45782), ('95.176.145.53', 50551), ('103.166.59.146', 14726), ('108.48.61.233', 49559), ('59.152.104.73', 45143), ('80.2.24.129', 56177), ('49.36.221.9', 58152), ('196.189.240.135', 54531), ('195.154.221.54', 27775), ('50.72.123.76', 18988), ('183.83.213.229', 46736), ('196.188.240.53', 59129), ('27.32.180.200', 63213), ('89.45.7.52', 58139), ('93.42.68.208', 41181), ('41.89.128.14', 6881), ('103.161.71.46', 19344), ('60.243.133.160', 59229), ('38.1.2.64', 53120), ('89.32.171.69', 60267), ('49.145.104.190', 21389), ('150.143.24.182', 57547), ('102.182.110.220', 62676), ('203.189.118.243', 63866), ('203.212.244.22', 61953), ('105.226.9.40', 13354), ('124.120.74.76', 38237), ('173.236.16.114', 49294), ('186.179.192.179', 54960), ('103.152.19.22', 56032), ('156.0.224.130', 56915), ('115.186.169.52', 57196), ('210.185.181.6', 25550), ('196.43.144.21', 10490), ('191.101.174.30', 38276), ('27.147.234.223', 53279), ('41.79.199.35', 0), ('27.7.102.72', 22067), ('80.99.194.238', 35037), ('195.216.219.82',53753), ('106.66.234.50', 6881), ('103.77.45.242', 11166), ('41.222.117.26', 0), ('5.189.153.125', 49970), ('96.46.210.165', 38595), ('202.83.126.236', 60910), ('178.152.18.202', 56955), ('112.211.122.101', 56307), ('95.236.76.19', 6881),('186.96.212.111', 36124), ('105.226.231.116', 0), ('181.188.94.197', 50527), ('137.1.160.223', 52029), ('185.216.74.10', 34635), ('197.185.110.47', 53535), ('103.72.178.150', 23007), ('174.3.100.178', 26451), ('185.38.14.195', 14209), ('103.119.95.221', 45869), ('182.18.206.152', 43357), ('196.190.101.2', 17942), ('60.241.144.149', 31858), ('103.137.14.238', 51413), ('136.158.103.143', 63765), ('103.71.79.136', 6890), ('196.191.248.242', 6881), ('108.62.107.235', 27420), ('223.228.34.95', 6933), ('146.196.35.228', 42628), ('210.1.246.16', 44644), ('59.153.103.19', 53790), ('102.176.51.18', 6881), ('27.34.13.212', 47396), ('82.38.159.35', 24222), ('103.210.144.64', 60123), ('192.145.117.68', 24870), ('37.33.180.238', 61483), ('182.18.206.3', 46501), ('46.236.167.211', 49366), ('117.212.220.213', 45682), ('49.37.214.152', 48504), ('196.189.62.237', 49160), ('197.136.59.2', 6881), ('103.25.242.5', 6881), ('59.94.78.244', 44892), ('52.195.7.7',50007), ('119.130.158.181', 49597), ('95.168.121.61', 45448), ('103.158.86.106', 25631), ('41.216.203.97', 6881), ('1.38.44.6', 43343), ('68.146.108.40', 51050), ('39.40.131.88', 51112), ('39.109.227.6', 6881), ('115.98.235.229', 55658), ('39.50.63.161', 44676), ('73.11.146.20', 51374), ('103.26.246.72', 22217), ('197.185.100.141', 36779), ('122.199.0.80', 28847), ('103.192.118.248', 50003), ('41.218.193.171', 52125), ('102.35.186.171', 21906), ('103.199.182.20', 14976), ('27.147.202.135', 11600), ('154.70.178.193', 64292), ('117.221.175.228', 30942), ('138.199.29.27', 16011), ('41.216.202.3', 30725), ('116.193.128.65', 46286), ('157.44.144.213', 16495), ('43.239.207.20', 31010), ('188.120.98.7', 32126), ('103.159.75.247', 20550), ('124.170.224.149', 14082), ('122.102.36.96', 57456), ('117.97.160.61', 56864), ('165.56.182.49', 38294), ('77.243.26.69', 27224), ('191.101.61.125', 33781), ('103.150.254.79', 41971), ('8.28.82.38', 57616), ('107.182.231.196', 45953), ('180.190.220.74', 29046), ('212.224.230.196', 23337), ('104.218.179.12', 50231), ('103.6.158.42', 20690), ('197.237.179.82', 18687), ('103.141.70.165', 40090), ('197.94.60.11', 37737), ('39.53.93.120', 14405), ('109.93.213.66', 20568), ('37.30.52.241', 22389), ('37.208.184.3', 51939), ('111.239.185.69', 23075), ('103.148.13.6', 16802), ('197.221.255.90', 61661), ('102.148.184.35', 6881), ('92.119.159.112', 62430), ('152.32.104.58', 46216), ('146.70.26.186', 55974), ('103.110.12.201', 55771), ('136.158.7.167', 64573), ('116.206.246.209', 56174), ('123.231.127.108', 63559), ('92.98.141.221', 22726), ('116.206.28.42', 10771), ('89.64.111.240', 28773), ('139.5.254.237', 47958), ('111.119.183.16', 60173), ('2.31.181.220', 64980), ('110.235.232.75', 58700), ('103.148.183.60', 48970), ('49.145.134.194', 34441), ('41.60.169.117', 33480), ('183.88.102.59', 25857), ('41.217.204.218', 44996), ('163.53.24.94', 59410), ('154.127.197.18', 28050), ('24.135.213.210', 19938), ('102.132.203.166', 58394), ('112.134.164.12', 6881), ('45.64.163.105', 51413), ('103.237.36.68', 61691), ('139.64.61.238', 10293), ('102.182.178.75', 60615), ('182.18.206.49', 46323), ('168.167.81.180', 6881), ('73.204.77.198', 6881), ('41.90.50.64', 10271)}

def peer_communication(ip, port, info_hash):
    peer_id = UDPTracker.gen_pid()
    p = Peer(ip, port)
    p.send_handshake(info_hash, peer_id)
    pid = p.recv_handshake(info_hash, peer_id)
    print(ip, port)
    try:
        r = p.recv()
        #print("recv1", r)
    except Exception as e:
        pass
        #print("ok ", e)
    
    try:
        p.send_interested()
        r2 = p.recv()
        print(ip, port, "recv2", r2)
    except Exception as e:
        pass
        #print("finally after interested", e)


futures = []
with ThreadPoolExecutor(max_workers=500) as executor:
    for ip, port in peer_list:
        future = executor.submit(peer_communication, ip, port, data.info_hash)
        futures.append(future)
    executor.shutdown(wait=True)


print("-"*30)
for future in futures:
    f = future.exception()
    if f == None:
        print(future.result())
    else:
        print("exception peer:",f)
print("-"*30)


"""
In the future maybe implement WebSocket trackers:
- ws connects only to via http without SSL
- wss connects only to via https with SSL
https://stackoverflow.com/questions/46557485/difference-between-ws-and-wss
"""
